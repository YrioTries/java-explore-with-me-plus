DROP TABLE IF EXISTS stats CASCADE;
DROP TABLE IF EXISTS apps CASCADE;

CREATE TABLE IF NOT EXISTS apps (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name VARCHAR(255) NOT NULL,
    CONSTRAINT pk_apps PRIMARY KEY (id),
    CONSTRAINT uq_apps_name UNIQUE (name)
);

CREATE TABLE IF NOT EXISTS stats (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    app_id BIGINT NOT NULL,
    uri VARCHAR(255) NOT NULL,
    ip VARCHAR(255) NOT NULL,
    created TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    CONSTRAINT pk_stats PRIMARY KEY (id),
    CONSTRAINT fk_stats_app_id FOREIGN KEY (app_id) REFERENCES apps(id) ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_stats_created ON stats(created);
CREATE INDEX IF NOT EXISTS idx_stats_uri ON stats(uri);
CREATE INDEX IF NOT EXISTS idx_stats_app_id ON stats(app_id);